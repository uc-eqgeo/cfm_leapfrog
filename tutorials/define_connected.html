<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Defining connected fault systems &mdash; cfm-leapfrog 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Leapfrog 3D mesh generation and fault cutting" href="../help/camilla.html" />
    <link rel="prev" title="Running tutorial examples using Jupyter" href="../help/running_examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            cfm-leapfrog
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction and Setup:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../help/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/install.html">Installation instructions and updates to code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/running_examples.html">Running tutorial examples using Jupyter</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Examples:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Defining connected fault systems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#reading-in-faults">Reading in faults</a></li>
<li class="toctree-l2"><a class="reference internal" href="#finding-connections-between-segments">Finding connections between segments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#making-and-incorporating-manual-edits">Making and incorporating manual edits</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#defining-a-cutting-hierarchy">Defining a cutting hierarchy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#suggesting-a-hierarchy-based-on-slip-rate">Suggesting a hierarchy based on slip rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#editing-the-cutting-hierarchy">Editing the cutting hierarchy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#create-shapefiles-for-mesh-creation">Create shapefiles for mesh creation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-directories-to-hold-shapefiles">Create directories to hold shapefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#write-out-shapefiles">Write out shapefiles</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meshing in Leapfrog:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../help/camilla.html">Leapfrog 3D mesh generation and fault cutting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Alternative workflows:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="define_connected_no_smoothing.html">Defining connected fault systems (without smoothing)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cfm-leapfrog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Defining connected fault systems</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/define_connected.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="defining-connected-fault-systems">
<h1>Defining connected fault systems<a class="headerlink" href="#defining-connected-fault-systems" title="Link to this heading"></a></h1>
<p>This notebook demonstrates how to identify which fault segments in a shapefile should be connected up into large fault systems.</p>
<section id="reading-in-faults">
<h2>Reading in faults<a class="headerlink" href="#reading-in-faults" title="Link to this heading"></a></h2>
<p>First, you need to read in your GIS representation of faults. In this example, we use a subset of faults from the New Zealand Community Fault Model (Seebeck et al., 2022).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import modules </span>
<span class="kn">from</span> <span class="nn">fault_mesh.faults.leapfrog</span> <span class="kn">import</span> <span class="n">LeapfrogMultiFault</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="c1"># Set coordinate system (optional) EPSG code</span>
<span class="c1"># If not desired, set to None</span>
<span class="n">epsg</span> <span class="o">=</span> <span class="mi">2193</span>
<span class="c1"># Read in fault data from shapefile</span>
<span class="n">fault_data</span> <span class="o">=</span> <span class="n">LeapfrogMultiFault</span><span class="o">.</span><span class="n">from_nz_cfm_shp</span><span class="p">(</span><span class="s2">&quot;tutorial_gis/cfm_gt_1_5.gpkg&quot;</span><span class="p">,</span> <span class="n">remove_colons</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">epsg</span><span class="o">=</span><span class="n">epsg</span><span class="p">)</span>

<span class="c1"># Alternative for full CFM:</span>
<span class="c1"># fault_data = LeapfrogMultiFault.from_nz_cfm_shp(&quot;../gis/NZ_CFM_v1_0_shapefile/NZ_CFM_v1_0.shp&quot;, remove_colons=True,</span>
<span class="c1">#                                                  exclude_aus=False, exclude_zero=False, exclude_region_min_sr=0.0)</span>

<span class="c1"># Alternative for different dip:</span>
<span class="c1"># fault_data = LeapfrogMultiFault.from_nz_cfm_shp(&quot;../gis/NZ_CFM_v1_0_shapefile/NZ_CFM_v1_0.shp&quot;, remove_colons=True,</span>
<span class="c1">#                                                  exclude_aus=False, exclude_zero=False, exclude_region_min_sr=0.0, dip)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>missing expected field
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning: missing expected field: (Depth_D90)
</pre></div>
</div>
</div>
</div>
</section>
<section id="finding-connections-between-segments">
<h2>Finding connections between segments<a class="headerlink" href="#finding-connections-between-segments" title="Link to this heading"></a></h2>
<p>Now your data are read in, you need to set the distance tolerance. This tolerance is the minimum horizontal distance between two fault traces that is allowed to count as a connection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist_tolerance</span> <span class="o">=</span> <span class="mf">200.</span>
</pre></div>
</div>
</div>
</div>
<p>The next cell uses python module networkx to find segment traces that are within the specified distance tolerance of each other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fault_data</span><span class="o">.</span><span class="n">find_connections</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 156 connections
Found 142 connections between segment ends
</pre></div>
</div>
</div>
</div>
<p>It is now necessary to write out these connections for manual editing and review. The file will be written out into the same directory as this Jupyter notebook. It will have a prefix supplied by you and the suffix “_suggested.csv”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fault_data</span><span class="o">.</span><span class="n">suggest_fault_systems</span><span class="p">(</span><span class="s2">&quot;central_gt1_5_connected&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This will create a CSV file that looks like this:</p>
<p><img alt="unedited_connected" src="../_images/connected_unedited.png" /></p>
<p>The name of the combined fault system is in the first column, and names of the faults that make up the connected system are in subsequent columns.</p>
</section>
<section id="making-and-incorporating-manual-edits">
<h2>Making and incorporating manual edits<a class="headerlink" href="#making-and-incorporating-manual-edits" title="Link to this heading"></a></h2>
<p>The automatically-generated fault system suggestions will (by design) include hyper-connected fault systems that need to be broken up. At this stage, the best way to break up these networks into smaller fault systems is to do it manually by editing the CSV file. An example below shows a new line added to the CSV representing the Hope Fault system – The Hope Fault is grouped with the Alpine and Kekerengu-Needles fault systems in the automatically-generated connections CSV. <strong>Make sure you save this new file with a different name to avoid overwriting it!</strong></p>
<p><img alt="edited_connected" src="../_images/connected_edited.png" /></p>
<p>Once you have made the necessary edits, read your new CSV to overwite the automatically-generated connected fault systems:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fault_data</span><span class="o">.</span><span class="n">read_fault_systems</span><span class="p">(</span><span class="s2">&quot;./define_connections_data/central_gt1_5_connected_edited.csv&quot;</span><span class="p">)</span>
<span class="n">fault_data</span><span class="o">.</span><span class="n">generate_curated_faults</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fault_data</span><span class="o">.</span><span class="n">read_fault_systems</span><span class="p">(</span><span class="s2">&quot;./define_connections_data/central_gt1_5_connected_edited.csv&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">fault_data</span><span class="o">.</span><span class="n">generate_curated_faults</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/leapfrog-fault-models/lib/python3.10/site-packages/fault_mesh/faults/leapfrog.py:231,</span> in <span class="ni">LeapfrogMultiFault.read_fault_systems</span><span class="nt">(self, fault_system_csv, trimming_gradient)</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span> <span class="n">segs</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span> <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segs</span><span class="p">]):</span>
<span class="ne">--&gt; </span><span class="mi">231</span>     <span class="n">cfault</span> <span class="o">=</span> <span class="n">ConnectedFaultSystem</span><span class="p">(</span><span class="n">overall_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">cfm_faults</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_names</span><span class="o">=</span><span class="n">segs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">232</span>                                   <span class="n">tolerance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_distance_tolerance</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">233</span>                                   <span class="n">trimming_gradient</span><span class="o">=</span><span class="n">trimming_gradient</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">234</span>                                   <span class="n">smooth_trace_refinements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothing_n</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">235</span>     <span class="bp">self</span><span class="o">.</span><span class="n">connected_faults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfault</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/leapfrog-fault-models/lib/python3.10/site-packages/fault_mesh/faults/connected.py:135,</span> in <span class="ni">ConnectedFaultSystem.__init__</span><span class="nt">(self, overall_name, cfm_faults, segment_names, search_patterns, excluded_names, tolerance, smooth_trace_refinements, trimming_gradient)</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_overall_trace</span> <span class="o">=</span> <span class="n">smooth_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">overall_trace</span><span class="p">,</span> <span class="n">n_refinements</span><span class="o">=</span><span class="n">smooth_trace_refinements</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segment_boundaries</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">135</span>     <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_segments</span> <span class="o">=</span> <span class="n">cut_line_at_multiple_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothed_overall_trace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_boundaries</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">136</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span>     <span class="bp">self</span><span class="o">.</span><span class="n">smoothed_segments</span> <span class="o">=</span> <span class="n">cut_line_at_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothed_overall_trace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment_boundaries</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nn">File ~/miniconda3/envs/leapfrog-fault-models/lib/python3.10/site-packages/fault_mesh/utilities/cutting.py:39,</span> in <span class="ni">cut_line_at_multiple_points</span><span class="nt">(line, points)</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span>     <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">cut_line_at_point</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">39</span>     <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">cut_line_at_point</span><span class="p">(</span><span class="n">line_to_cut</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span> <span class="n">line_to_cut</span> <span class="o">=</span> <span class="n">l2</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l1</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/leapfrog-fault-models/lib/python3.10/site-packages/fault_mesh/utilities/cutting.py:27,</span> in <span class="ni">cut_line_at_point</span><span class="nt">(line, point)</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">Point</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">27</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">cut</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="k">return</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span>

<span class="nn">File ~/miniconda3/envs/leapfrog-fault-models/lib/python3.10/site-packages/fault_mesh/utilities/cutting.py:11,</span> in <span class="ni">cut</span><span class="nt">(line, distance)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">11</span>     <span class="n">pd</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="k">if</span> <span class="n">pd</span> <span class="o">==</span> <span class="n">distance</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>         <span class="k">return</span> <span class="p">[</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>             <span class="n">LineString</span><span class="p">(</span><span class="n">coords</span><span class="p">[:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>             <span class="n">LineString</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">:])]</span>

<span class="nn">File ~/miniconda3/envs/leapfrog-fault-models/lib/python3.10/site-packages/shapely/impl.py:37,</span> in <span class="ni">delegated.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">37</span>         <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>     <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>         <span class="k">raise</span> <span class="n">ImplementationError</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>             <span class="s2">&quot;Method &#39;</span><span class="si">%s</span><span class="s2">&#39; not provided by registered &quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>             <span class="s2">&quot;implementation &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">impl</span><span class="p">))</span>

<span class="nn">File ~/miniconda3/envs/leapfrog-fault-models/lib/python3.10/site-packages/shapely/geometry/base.py:913,</span> in <span class="ni">BaseGeometry.project</span><span class="nt">(self, other, normalized)</span>
<span class="g g-Whitespace">    </span><span class="mi">911</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">912</span>     <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">impl</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">913</span> <span class="k">return</span> <span class="n">op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/leapfrog-fault-models/lib/python3.10/site-packages/shapely/linref.py:18,</span> in <span class="ni">ProjectOp.__call__</span><span class="nt">(self, this, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_line</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">18</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">_geom</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_geom</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="defining-a-cutting-hierarchy">
<h1>Defining a cutting hierarchy<a class="headerlink" href="#defining-a-cutting-hierarchy" title="Link to this heading"></a></h1>
<p>Now you have defined your fault system (which you will later use to create meshes), it is necessary to specify which faults terminate against other faults. For example, it seems highly likely that the western end of the Hope Fault is truncated at depth by the Alpine fault. This complex mesh cutting is best achieved using dedicated software such as leapfrog (see below), but for cutting to be done automatically, it is best to first specify a <em>cutting hierarchy</em>.</p>
<section id="suggesting-a-hierarchy-based-on-slip-rate">
<h2>Suggesting a hierarchy based on slip rate<a class="headerlink" href="#suggesting-a-hierarchy-based-on-slip-rate" title="Link to this heading"></a></h2>
<p>A first pass at a hierarchy can be generated based purely on fault slip rate. Assuming that the fault data you have already read in have slip rates associated with them, this first pass is easy to make:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fault_data</span><span class="o">.</span><span class="n">suggest_cutting_hierarchy</span><span class="p">(</span><span class="s2">&quot;central_gt1_5_hierarchy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This operation simply orders the faults (or fault systems) in your model in descending order of slip rate. For connected fault systems that have segments with different slip rates, the maximum slip rate of any segment in that fault system is used to place the fault system in the cutting hierarchy.</p>
</section>
<section id="editing-the-cutting-hierarchy">
<h2>Editing the cutting hierarchy<a class="headerlink" href="#editing-the-cutting-hierarchy" title="Link to this heading"></a></h2>
<p>You can then edit this hierarchy by switching the order of lines in the file. For any pair of faults/systems that intersect, the fault closer to the bottom of the file will terminate against the fault closer to the top of the list.
An example of a situation where editing is desirable is illustrated below. The maximum slip rate of the Jordan-Kekerengu-Needles Fault System (23 mm/yr) is faster than the corresponding maximum for the Hope Fault (15.8 mm/yr), but we wish to create a fault model where the Jordan Fault terminates against the Hope Fault. We effect this termination by moving <code class="docutils literal notranslate"><span class="pre">Hope</span> <span class="pre">combined</span></code> above <code class="docutils literal notranslate"><span class="pre">Jordan</span> <span class="pre">-</span> <span class="pre">Kek</span> <span class="pre">-</span> <span class="pre">Needles</span> <span class="pre">combined</span></code> in the CSV file. For similar reasons, we move the <code class="docutils literal notranslate"><span class="pre">Hanmer</span></code> Fault above <code class="docutils literal notranslate"><span class="pre">Hope</span> <span class="pre">Hanmer</span> <span class="pre">NW</span></code>.</p>
<p><img alt="Adjust hierarchy" src="../_images/reorder_hierarchy.png" /></p>
<p>We read in this new hierarchy as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fault_data</span><span class="o">.</span><span class="n">read_cutting_hierarchy</span><span class="p">(</span><span class="s2">&quot;./define_connections_data/central_gt1_5_hierarchy_edited.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="create-shapefiles-for-mesh-creation">
<h1>Create shapefiles for mesh creation<a class="headerlink" href="#create-shapefiles-for-mesh-creation" title="Link to this heading"></a></h1>
<p>The final pre-meshing step is the creation of files that can be combined with meshing software to create triangular mesh representations of faults.
Although it is possible to construct these triangular surfaces in multiple software packages (for example, MOVE 3D), the following discussion is geared towards use with Leapfrog Geo software.</p>
<section id="create-directories-to-hold-shapefiles">
<h2>Create directories to hold shapefiles<a class="headerlink" href="#create-directories-to-hold-shapefiles" title="Link to this heading"></a></h2>
<p>For organisational reasons, it helps to have the different shapefiles in different directories</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">dir_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;depth_contours&quot;</span><span class="p">,</span> <span class="s2">&quot;traces&quot;</span><span class="p">,</span> <span class="s2">&quot;footprints&quot;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="write-out-shapefiles">
<h2>Write out shapefiles<a class="headerlink" href="#write-out-shapefiles" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">fault</span> <span class="ow">in</span> <span class="n">fault_data</span><span class="o">.</span><span class="n">curated_faults</span><span class="p">:</span>
    <span class="c1"># Generate depth contours</span>
    <span class="n">fault</span><span class="o">.</span><span class="n">generate_depth_contours</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mf">32000.</span><span class="p">,</span> <span class="mf">2000.</span><span class="p">),</span> <span class="n">smoothing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Write contours to files</span>
    <span class="n">fault</span><span class="o">.</span><span class="n">contours</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;depth_contours/</span><span class="si">{</span><span class="n">fault</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_contours.shp&quot;</span><span class="p">)</span>
    <span class="c1"># Write traces</span>
    <span class="n">fault</span><span class="o">.</span><span class="n">nztm_trace_geoseries</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;traces/</span><span class="si">{</span><span class="n">fault</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_trace.shp&quot;</span><span class="p">)</span>

<span class="c1"># Write fault footprints</span>
<span class="k">for</span> <span class="n">fault</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">fault_data</span><span class="o">.</span><span class="n">curated_faults</span><span class="p">):</span>
    <span class="n">fault</span><span class="o">.</span><span class="n">adjust_footprint</span><span class="p">()</span>
    <span class="n">fault</span><span class="o">.</span><span class="n">footprint_geoseries</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;footprints/</span><span class="si">{</span><span class="n">fault</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_footprint.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../help/running_examples.html" class="btn btn-neutral float-left" title="Running tutorial examples using Jupyter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../help/camilla.html" class="btn btn-neutral float-right" title="Leapfrog 3D mesh generation and fault cutting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Andy Howell and Camilla Penney.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>